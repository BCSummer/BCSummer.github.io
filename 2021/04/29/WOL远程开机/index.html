<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>WOL远程开机 | Basing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="WOL远程开机——通过ESP8266+Binker平台实现之前疫情现在家里，无聊时改装家里的吸顶灯入网时，寻找了各种物联网平台，最终找到了blinker（点灯）这个物联网平台，APP很简洁，同时提供方便的API接口，非常适于DIY。然后就是这次的想法，开学后已经搞好了Teamview远程连接自己的实验室电脑，使自己在宿舍也能科（hua）研（shui），但又因为实验室电脑总是开着，感觉不舒服（毕竟是">
<meta property="og:type" content="article">
<meta property="og:title" content="WOL远程开机">
<meta property="og:url" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/index.html">
<meta property="og:site_name" content="Basing">
<meta property="og:description" content="WOL远程开机——通过ESP8266+Binker平台实现之前疫情现在家里，无聊时改装家里的吸顶灯入网时，寻找了各种物联网平台，最终找到了blinker（点灯）这个物联网平台，APP很简洁，同时提供方便的API接口，非常适于DIY。然后就是这次的想法，开学后已经搞好了Teamview远程连接自己的实验室电脑，使自己在宿舍也能科（hua）研（shui），但又因为实验室电脑总是开着，感觉不舒服（毕竟是">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/%E5%8E%9F%E7%90%86.png">
<meta property="og:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/1.png">
<meta property="og:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/2.png">
<meta property="og:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/3.png">
<meta property="og:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/WOLpcset1.png">
<meta property="og:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/WOLpcset2.png">
<meta property="og:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/WOLpcset3.png">
<meta property="og:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/app1.png">
<meta property="og:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/app2.jpg">
<meta property="og:image" content="http://example.com/%5Cappset1.png">
<meta property="og:image" content="http://example.com/%5Cappset2.png">
<meta property="og:image" content="http://example.com/%5Cappset3.png">
<meta property="og:image" content="http://example.com/%5Cappset4.png">
<meta property="og:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/appset5.png">
<meta property="og:image" content="http://example.com/%5Cappset6.png">
<meta property="og:image" content="http://example.com/%5Cappset7.jpg">
<meta property="article:published_time" content="2021-04-29T13:58:19.000Z">
<meta property="article:modified_time" content="2021-04-29T14:41:57.729Z">
<meta property="article:author" content="BC Wu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/%E5%8E%9F%E7%90%86.png">
  
    <link rel="alternate" href="/atom.xml" title="Basing" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Basing</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-WOL远程开机" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/" class="article-date">
  <time class="dt-published" datetime="2021-04-29T13:58:19.000Z" itemprop="datePublished">2021-04-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      WOL远程开机
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="WOL远程开机——通过ESP8266-Binker平台实现"><a href="#WOL远程开机——通过ESP8266-Binker平台实现" class="headerlink" title="WOL远程开机——通过ESP8266+Binker平台实现"></a>WOL远程开机——通过ESP8266+Binker平台实现</h1><p>之前疫情现在家里，无聊时改装家里的吸顶灯入网时，寻找了各种物联网平台，最终找到了blinker（点灯）这个物联网平台，APP很简洁，同时提供方便的API接口，非常适于DIY。<br>然后就是这次的想法，开学后已经搞好了Teamview远程连接自己的实验室电脑，使自己在宿舍也能科（hua）研（shui），但又因为实验室电脑总是开着，感觉不舒服（毕竟是自己配的机子，不舍得一直烧着）。于是想着怎么远程开关机，淘宝上的向日葵开机棒一个108，看了看原理，发现身为一个电子专业的科研狗，买了就是交智商税，刚好想到了用前面提到的平台，就可以实现远程开机，最后成本就8块钱（或者不要钱，我的ESP8266是本科玩剩下的，用不完就送学弟了）。</p>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>本方法适合没公网IP的、没自己服务器的、没高级路由器的三无玩家，有以上几个的也可以这么搞，但没必要，毕竟（教程一堆）：</p>
<ol>
<li>宽带是公网IP的直接走内网映射</li>
<li>有腾讯云、阿里云服务器的直接走转发</li>
<li>有高级路由器的（带WOL功能）直接设置<br>但是如果图方便也可以<h2 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h2></li>
<li>计算机网络基本知识</li>
<li>C语言基本知识</li>
<li>Arduino编程经验（没有也行）<br>（如果是电子专业的，肯定没啥障碍）</li>
</ol>
<h2 id="所需材料和前提"><a href="#所需材料和前提" class="headerlink" title="所需材料和前提"></a>所需材料和前提</h2><h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><ol start="0">
<li>自己的电脑支持WOL</li>
<li>连着网的路由器</li>
</ol>
<p><em><strong>（没有上面两个前提的可以直接放弃）</strong></em></p>
<h3 id="材料"><a href="#材料" class="headerlink" title="材料"></a>材料</h3><ol start="2">
<li>手机APP（blinker，Android &amp; IOS 平台都有）</li>
<li>ESP8266模块一个<h3 id="调试下载工具"><a href="#调试下载工具" class="headerlink" title="调试下载工具"></a>调试下载工具</h3></li>
<li>Arduino IDE平台（编译用）</li>
<li>USB转TTL模块（下载用）</li>
</ol>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>如果有上述提到的预备知识，则整体原理会非常简单，一句话概括就是手机APP端发送MQTT包到ESP8266，ESP8266转发WOL的UDP包到本地子网。</p>
<h3 id="WOL"><a href="#WOL" class="headerlink" title="WOL"></a>WOL</h3><p><em><strong>WOL(Wake On LAN)</strong></em> 局域网唤醒，顾名思义，是一种在局域网内唤醒PC的一种技术。其主要原理是向本地子网内的机器广播一个包含有目标机器网卡MAC地址的一个UDP包（WOL魔术包），所有接收到的机器解析包中的MAC地址，匹配成功的网卡发送对应命令，开启电脑。  </p>
<h3 id="Blinker平台"><a href="#Blinker平台" class="headerlink" title="Blinker平台"></a>Blinker平台</h3><p>Blinker平台简介其官网有具体的介绍（<a target="_blank" rel="noopener" href="https://diandeng.tech/doc/home">链接在这</a>），在此就大致说明一下本方法所用到的原理即可。</p>
<img src="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/%E5%8E%9F%E7%90%86.png" class="">

<p>大致原理即如图所示，在局域网内网中，手机客户端直接通过局域网与ESP8266通讯，ESP8266接收到指令后进行WOL包的广播发送，在非局域网的远程连接中，ESP8266与Blinker服务器连接，同时手机客户端向Blinker服务器发送相关指令后，服务器转发给远端的ESP8266后，ESP8266发送WOL包唤醒电脑。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="STEP1：设置WOL（实现内网唤醒）"><a href="#STEP1：设置WOL（实现内网唤醒）" class="headerlink" title="STEP1：设置WOL（实现内网唤醒）"></a>STEP1：设置WOL（实现内网唤醒）</h3><p>WOL在BIOS中设置，具体的机器需要具体设置，就是在BIOS中打开一个选项开关，具体步骤自己在BIOS中找，我的电脑的设置如下：</p>
<img src="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/1.png" class="" title="BIOS设置-STEP1">
<br/>
<img src="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/2.png" class="" title="BIOS设置-STEP2&amp;3">
<br/>
<img src="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/3.png" class="" title="BIOS设置-STEP4">
<br/>
其次就是在Windows中设置网卡的步骤，设置步骤如下：  
首先在设备管理器中找到自己的以太网卡，找到连网线的那个网卡，进行如下操作：  
<img src="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/WOLpcset1.png" class="" title="步骤1-6">

<p>然后继续在此页面下进行已下操作：</p>
<img src="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/WOLpcset2.png" class="" title="步骤7-8">

<p>最后在网络和共享中心中查看自己网卡的MAC地址和IP地址：</p>
<img src="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/WOLpcset3.png" class="" title="查看MAC和IP">

<p>全部设置正确后，便可以在本地局域网下进行设备唤醒了。<br>iOS下的Wolow软件可以进行测试，在手机连接路由器后（手机，电脑在同一个子网下，同时路由器没有开启AP隔离功能（一般都不开启）），进入对应设置，点击唤醒电脑就可以唤醒了。  </p>
<p><strong>注：最好在路由器中设置PC的IP与MAC绑定，方便后续的开机状态检查，若不设置此项，开机功能可以用，但是可能无法进行设备开启状态检查!!!</strong></p>
<p>Wolow软件设置如下：  </p>
<p>首先添加新设备，界面如下：  </p>
<img src="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/app1.png" class="" width="300" height="600" title="app1">

<p>接下来按照提示进行相关设置的填写，界面如下：</p>
<img src="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/app2.jpg" class="" width="300" height="600" title="app2">

<p>设置完成后进行测试，若PC没能启动检查是否有设置错误的地方，直到测试成功唤醒。</p>
<h3 id="STEP2：ESP8266程序编写-Blinker设置（实现外网唤醒）"><a href="#STEP2：ESP8266程序编写-Blinker设置（实现外网唤醒）" class="headerlink" title="STEP2：ESP8266程序编写 + Blinker设置（实现外网唤醒）"></a>STEP2：ESP8266程序编写 + Blinker设置（实现外网唤醒）</h3><p>先贴程序，对着程序进行解释：  </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 本项目简单的利用了blinker的Button例程，在客户端按下按键后，</span></span><br><span class="line"><span class="comment"> * 通过MQTT通知ESP8266触发按键处理函数，按键处理函数主要负责</span></span><br><span class="line"><span class="comment"> * 发送WOL的UDP魔术包，WOL魔术包格式如下</span></span><br><span class="line"><span class="comment"> * FF FF FF FF FF FF ( XX XX XX XX XX XX (网卡的MAC地址)) x 16</span></span><br><span class="line"><span class="comment"> * 包的总大小为 6+6*16 = 102 Byte </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLINKER_WIFI</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Blinker.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对应客户端的秘钥</span></span><br><span class="line"><span class="keyword">char</span> auth[] = <span class="string">&quot;************&quot;</span>;</span><br><span class="line"><span class="comment">//WIFI SSID</span></span><br><span class="line"><span class="keyword">char</span> ssid[] = <span class="string">&quot;XXXX&quot;</span>;</span><br><span class="line"><span class="comment">//WIFI Password</span></span><br><span class="line"><span class="keyword">char</span> pswd[] = <span class="string">&quot;XXXX&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUTTON_1 <span class="meta-string">&quot;OPEN&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WiFiUDP Udp;</span><br><span class="line"><span class="comment">//网卡的IP地址</span></span><br><span class="line"><span class="function"><span class="keyword">const</span> IPAddress <span class="title">remote_ip</span><span class="params">(<span class="number">192</span>, <span class="number">168</span>, <span class="number">0</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="comment">//根据自己的路由器选择子网段的广播地址</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BROADCAST_ADD <span class="meta-string">&quot;192.168.1.255&quot;</span></span></span><br><span class="line"><span class="comment">//网卡唤醒端口(一般为9或7，可以在BIOS中查看)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REMOTEPORT 9</span></span><br><span class="line"><span class="comment">//ESP8266端口，随便填一个，也填成9</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOCALPORT 9</span></span><br><span class="line"><span class="comment">//网卡的MAC地址 6个字节    </span></span><br><span class="line"><span class="keyword">char</span> NETCARD_MAC[<span class="number">6</span>] = &#123;<span class="number">0xAA</span>,<span class="number">0xAA</span>,<span class="number">0xAA</span>,<span class="number">0xAA</span>,<span class="number">0xAA</span>,<span class="number">0xAA</span>&#125;;</span><br><span class="line"><span class="comment">//WOL包</span></span><br><span class="line"><span class="keyword">char</span> WOL_Buffer[<span class="number">102</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//调试开关</span></span><br><span class="line"><span class="comment">//#define WOL_DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//WOL魔术包初始化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WOL_packet_init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i,j;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">	WOL_Buffer[i] = <span class="number">0xFF</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;<span class="number">17</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">6</span>;j++)</span><br><span class="line">		&#123;</span><br><span class="line">		WOL_Buffer[i*<span class="number">6</span> + j] = NETCARD_MAC[j];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> WOL_DEBUG	</span></span><br><span class="line">	Serial.<span class="built_in">printf</span>(<span class="string">&quot;The WOL packet is :\n&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">102</span>;i++)&#123;</span><br><span class="line">		Serial.<span class="built_in">printf</span>(<span class="string">&quot;%x &quot;</span>,WOL_Buffer[i]);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WOL_packet_transfer</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> WOL_DEBUG	</span></span><br><span class="line">	Serial.<span class="built_in">printf</span>(<span class="string">&quot;NOW is send WOL packet!\n&quot;</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	Udp.<span class="built_in">beginPacket</span>(BROADCAST_ADD, REMOTEPORT);</span><br><span class="line">	Udp.<span class="built_in">write</span>(WOL_Buffer);</span><br><span class="line">	Udp.<span class="built_in">endPacket</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BlinkerButton <span class="title">Button1</span><span class="params">(BUTTON_1)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">button1_callback</span><span class="params">(<span class="keyword">const</span> String &amp; state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">BLINKER_LOG</span>(<span class="string">&quot;get button state: &quot;</span>, state);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (state == BLINKER_CMD_BUTTON_TAP) &#123;</span><br><span class="line">		<span class="built_in">BLINKER_LOG</span>(<span class="string">&quot;Button tap!&quot;</span>);</span><br><span class="line">		<span class="built_in">WOL_packet_transfer</span>();</span><br><span class="line">		<span class="built_in">BLINKER_LOG</span>(<span class="string">&quot;WOL Packet Transfer Completed!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">BLINKER_LOG</span>(<span class="string">&quot;Get user setting: &quot;</span>, state);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dataRead</span><span class="params">(<span class="keyword">const</span> String &amp; data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">BLINKER_LOG</span>(<span class="string">&quot;Blinker readString: &quot;</span>, data);</span><br><span class="line">	Blinker.<span class="built_in">vibrate</span>();</span><br><span class="line">	<span class="keyword">uint32_t</span> BlinkerTime = <span class="built_in">millis</span>();</span><br><span class="line">	Blinker.<span class="built_in">print</span>(<span class="string">&quot;millis&quot;</span>, BlinkerTime);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Serial.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line">	BLINKER_DEBUG.<span class="built_in">stream</span>(Serial);</span><br><span class="line">	Blinker.<span class="built_in">begin</span>(auth, ssid, pswd);</span><br><span class="line">	Blinker.<span class="built_in">attachData</span>(dataRead);</span><br><span class="line">	Button1.<span class="built_in">attach</span>(button1_callback);</span><br><span class="line">	Udp.<span class="built_in">begin</span>(LOCALPORT);</span><br><span class="line">	<span class="built_in">WOL_packet_init</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Blinker.<span class="built_in">run</span>();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> WOL_DEBUG</span></span><br><span class="line">	<span class="keyword">if</span>((Serial.<span class="built_in">read</span>() == <span class="number">0x96</span>) || <span class="built_in">digitalRead</span>(<span class="number">0</span>) == LOW)&#123;</span><br><span class="line">		<span class="built_in">WOL_packet_transfer</span>();</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">digitalRead</span>(<span class="number">0</span>) == LOW)&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="（1）程序设置"><a href="#（1）程序设置" class="headerlink" title="（1）程序设置"></a>（1）程序设置</h4><p>上述程序中，基本功能已经编写好，不想加新东西的话只需要设置以下几项：<br>客户端相关设置（两项）：<br>设备注册使用：  </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对应客户端的秘钥</span></span><br><span class="line"><span class="keyword">char</span> auth[] = <span class="string">&quot;************&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>客户端里的按键的名字，注册按键处理回调函数使用。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUTTON_1 <span class="meta-string">&quot;OPEN&quot;</span></span></span><br></pre></td></tr></table></figure>
<p>路由器相关设置（两项）：<br>路由器SSID：  </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WIFI SSID</span></span><br><span class="line"><span class="keyword">char</span> ssid[] = <span class="string">&quot;XXXX&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>路由器密码：  </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WIFI Password</span></span><br><span class="line"><span class="keyword">char</span> pswd[] = <span class="string">&quot;XXXX&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>路由器子网广播地址，将路由器网关地址最后换成255即就是广播地址</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据自己的路由器选择子网段的广播地址</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BROADCAST_ADD <span class="meta-string">&quot;192.168.1.255&quot;</span></span></span><br></pre></td></tr></table></figure>
<p>PC端相关设置（两项）：<br>网卡端口号，一般为7或者9，之前Wolow软件测试用到过。  </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//网卡唤醒端口(一般为9或7，可以在BIOS中查看)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REMOTEPORT 9</span></span><br></pre></td></tr></table></figure>
<p>PC网卡的MAC地址，之前测试用到过。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//网卡的MAC地址 6个字节    </span></span><br><span class="line"><span class="keyword">char</span> NETCARD_MAC[<span class="number">6</span>] = &#123;<span class="number">0xAA</span>,<span class="number">0xAA</span>,<span class="number">0xAA</span>,<span class="number">0xAA</span>,<span class="number">0xAA</span>,<span class="number">0xAA</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>PC网卡的IP地址，检测开机状态需要用到。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;网卡的IP地址</span><br><span class="line">const IPAddress remote_ip(192, 168, 0, 1);</span><br></pre></td></tr></table></figure>

<p>除了客户端相关的两项设置目前无法填写之外，其余的内容在之前的步骤中已经出现过，可以直接填写。</p>
<h4 id="（2）客户端APP设置"><a href="#（2）客户端APP设置" class="headerlink" title="（2）客户端APP设置"></a>（2）客户端APP设置</h4><p>首先打开Blinker的APP，没注册的先注册，然后开始设备申请流程：</p>
<p>Step1：添加设备，选择Arduino设备</p>
<p><img src="/%5Cappset1.png"></p>
<p>Step2：选择WIFI接入</p>
<p><img src="/%5Cappset2.png"></p>
<p>Step3：得到设备秘钥，此秘钥对应着程序中的秘钥，直接复制进程序中即可。</p>
<p><img src="/%5Cappset3.png"></p>
<p>Step4：返回主界面，点击进入申请号的设备中</p>
<p><img src="/%5Cappset4.png"></p>
<p>Step5：点击右上角的编辑按键，进入编辑界面，然后添加一个按键，点击出现的按键进入按键设置中</p>
<p><img src="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/appset5.png"></p>
<p>Step6：在按键的基础设置中，首先设置数据键名，此键名为程序中客户端设置的第二个需要填写的项，将此项填入程序中，接着选择按键类型为普通按键即可，其余项目可以不用在意。设置完后保存，退出编辑界面。</p>
<p><img src="/%5Cappset6.png"></p>
<p>Step7：完成APP设置后回到设备主界面，如下：</p>
<p><img src="/%5Cappset7.jpg"></p>
<p>至此，已经完成相关客户端的相关项设置。</p>
<h3 id="STEP3：程序烧写"><a href="#STEP3：程序烧写" class="headerlink" title="STEP3：程序烧写"></a>STEP3：程序烧写</h3><p>将前两步的相关设置填写入程序中，打开Arduino IDE进行程序烧写，需要提前设置IDE的环境，这里就不多讲了，Blinker的开发说明中有非常详细的安装操作步骤（<a target="_blank" rel="noopener" href="https://diandeng.tech/doc/getting-start-8266">连接在这</a>）,完成后点击编译下载进ESP8266模块中（使用IDE下载或使用官方的下载都行，都是通过串口下载，这个也就不多说了，毕竟网上关于ESP8266的资料漫天飞）。</p>
<p>下载完成后，重新启动模块，等待模块连接WIFI成功，同时，在手机客户端可以看见之前的设备从离线状态变为在线状态，点击进入设备，点击按键（此时手机在内外网均可），不出意外，则PC成功启动。</p>
<h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><p>这只是个简单的开机模块，至于远程开机有什么用，对于我来说就是配合Teamview实现在宿舍科研，远程跑个仿真啥的非常方便，不用的话可以在 <em><strong>power shell</strong></em> 中利用 <em><strong>shutdown -s</strong></em> 指令进行关机，减少机子的空耗时间，增加寿命。这只是个基础的版本，后面可以添加各种功能进行DIY，利用消息模块进行电脑开机状态的检查，并返回到手机APP端，或者添加其他功能都可以。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/" data-id="cko2zhctp0000w2u4ghu29a7l" data-title="WOL远程开机" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2021/04/29/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/29/WOL%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA/">WOL远程开机</a>
          </li>
        
          <li>
            <a href="/2021/04/29/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 BC Wu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>